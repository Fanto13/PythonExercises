<!DOCTYPE html>
<html>

<head>
    <title>MNIST Character Sampling</title>
    <style>
        canvas {
            border: 1px solid black;
        }
    </style>

    <script>
        async function postData(url = "", data = {}) {
            console.log("sending data:", data)//debug
            // Default options are marked with *
            const response = await fetch(url, {
                method: "POST", "OPTIONS", // *GET, POST, PUT, DELETE, etc.
                mode: "cors", // no-cors, *cors, same-origin
                cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
                credentials: "same-origin", // include, *same-origin, omit
                headers: {
                    "Content-Type": "application/json",
                    // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                redirect: "follow", // manual, *follow, error
                referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                body: JSON.stringify(data), // body data type must match "Content-Type" header
            });
            .then((response) => {
                console.log("Received response:", response); // Debugging message
                return response.json();
              })
              .catch((error) => {
                console.error("Error:", error); // Debugging message
              });
           
        } 
        return response.json(); // parses JSON response into native JavaScript objects
    </script>
</head>

<body>
    <canvas id="canvas" width="280" height="280"></canvas>
    <br>
    <button onclick="sampleCharacter()">Sample Character</button>
    <script>
        var context = canvas.getContext('2d');
        var isDrawing = false;

        // Add event listeners for mouse actions
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseleave', stopDrawing);

        // Function to start drawing
        function startDrawing(event) {
            isDrawing = true;
            draw(event);
        }

        // Function to draw on the canvas
        function draw(event) {
            if (!isDrawing) return;
            context.fillRect(event.offsetX, event.offsetY, 20, 20);
        }

        // Function to stop drawing
        function stopDrawing() {
            isDrawing = false;
        }

        // Function to sample the character
        function sampleCharacter() {
            var resizedCanvas = document.createElement('canvas');
            resizedCanvas.width = 28;
            resizedCanvas.height = 28;
            var resizedContext = resizedCanvas.getContext('2d');
            resizedContext.drawImage(canvas, 0, 0, 28, 28);

            // Get the image data of the resized canvas
            var imageData = resizedContext.getImageData(0, 0, 28, 28).data;

            // Convert the image data to grayscale and normalize the values
            var grayscaleData = [];
            for (var i = 0; i < imageData.length; i += 4) {
                var a = imageData[i + 3];
                var grayValue = a / 255;
                grayscaleData.push(grayValue);
            }
            console.log(grayscaleData)

            // Pass the grayscale data to your MNIST model for prediction
            // Here, you can send the data to your server or perform client-side inference

            // Example: Display the grayscale data in the console

            postData("/predict", {
                    image: grayscaleData
                })
                .then((data) => {
                    console.log(data); // JSON data parsed by `data.json()` call
                });
        }
    </script>
</body>

</html>